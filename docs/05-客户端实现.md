# DuckChat å®¢æˆ·ç«¯å®ç°

æœ¬æ–‡æ¡£æè¿°äº† DuckChat å®¢æˆ·ç«¯çš„å…·ä½“å®ç°é€»è¾‘å’Œä»£ç ç»“æ„ï¼ŒåŸºäºå®é™…çš„ä»£ç å®ç°ã€‚

## æ ¸å¿ƒæ¶æ„

### ä¸»è¦ç»„ä»¶
- **ä¸»å®¢æˆ·ç«¯** ([`client.cpp`](../client/client.cpp)): ç¨‹åºå…¥å£å’Œä¸»å¾ªç¯
- **çª—å£ç®¡ç†å™¨** ([`window_manager.hpp`](../client/window_manager.hpp)): ç®¡ç†ç”¨æˆ·ç•Œé¢å’Œçª—å£æ˜¾ç¤º
- **èŠå¤©ç®¡ç†å™¨** ([`chat_manager.hpp`](../client/chat_manager.hpp)): å¤„ç†èŠå¤©é€»è¾‘å’Œç½‘ç»œé€šä¿¡
- **é€šä¿¡åè®®** ([`common/protocal.hpp`](../common/protocal.hpp)): å®šä¹‰æ•°æ®åŒ…æ ¼å¼
- **ç½‘ç»œé€šä¿¡** ([`common/network.hpp`](../common/network.hpp)): å¤„ç†ç½‘ç»œä¼ è¾“

### çº¿ç¨‹æ¨¡å‹
```
ä¸»çº¿ç¨‹ (UIæ¸²æŸ“å’Œè¾“å…¥å¤„ç†)
â”œâ”€â”€ ç½‘ç»œçº¿ç¨‹ (æ¶ˆæ¯æ”¶å‘)
â”œâ”€â”€ æ¶ˆæ¯å¤„ç†çº¿ç¨‹ (åè®®è§£æ)
â””â”€â”€ UIæ›´æ–°çº¿ç¨‹ (ç•Œé¢åˆ·æ–°)
```

## æ ¸å¿ƒç±»è®¾è®¡

### ä¸»å®¢æˆ·ç«¯ (client.cpp)

å®¢æˆ·ç«¯é‡‡ç”¨å¤šçº¿ç¨‹æ¶æ„ï¼Œä¸»çº¿ç¨‹è´Ÿè´£UIäº¤äº’ï¼Œåå°çº¿ç¨‹å¤„ç†ç½‘ç»œé€šä¿¡ï¼š

```cpp
// æ ¸å¿ƒå¯åŠ¨æµç¨‹ - å®Œæ•´å®ç°è§: client/client.cpp:32-141
int main() {
    // 1. ç½‘ç»œè¿æ¥å»ºç«‹
    server_fd = socket(AF_INET, SOCK_STREAM, 0);
    // ... è¿æ¥æœåŠ¡å™¨é€»è¾‘
    
    // 2. ç”¨æˆ·è®¤è¯ (æ³¨å†Œ/ç™»å½•)
    // ... è®¤è¯æµç¨‹
    
    // 3. å¯åŠ¨ç½‘ç»œæ¥æ”¶çº¿ç¨‹
    thread client_thread_receive(handle_server_receive);
    client_thread_receive.detach();
    
    // 4. åˆå§‹åŒ–UIå’ŒèŠå¤©ç®¡ç†å™¨
    chat_manager = ChatManager(server_fd, &window_manager, user_id, username);
    chat_manager.initiate();
    window_manager.initiate();
    
    // 5. å¯åŠ¨UIä¸»å¾ªç¯
    window_manager.handle_input();
}
```

> ğŸ’¡ **è®¾è®¡å†³ç­–**: åˆ†ç¦»UIçº¿ç¨‹å’Œç½‘ç»œçº¿ç¨‹ï¼Œé¿å…ç½‘ç»œé˜»å¡å½±å“ç”¨æˆ·ä½“éªŒã€‚

### WindowManager ç±»
```cpp
class WindowManager {
private:
    // ncurses çª—å£å¥æŸ„
    WINDOW* main_window;
    WINDOW* chat_window;
    WINDOW* input_window;
    WINDOW* status_window;
    
    // çª—å£å°ºå¯¸
    int main_height, main_width;
    int chat_height, chat_width;
    int input_height, input_width;
    
    // UIçŠ¶æ€
    bool running;
    int current_chat_index;
    
public:
    // æ ¸å¿ƒæ–¹æ³•
    void initiate();                    // åˆå§‹åŒ–UIç³»ç»Ÿ
    void handle_input();                 // ä¸»è¾“å…¥å¾ªç¯
    void refresh_windows();              // åˆ·æ–°æ‰€æœ‰çª—å£
    
    // æ¸²æŸ“æ–¹æ³•
    void render_chat_history(const std::vector<Message>& messages);
    void render_chats(const std::vector<ChatInfo>& chats);
    void show_status(const std::string& message, bool is_error = false);
    
    // äº¤äº’æ§åˆ¶
    void scroll_messages(int direction);
    void scroll_chats(int direction);
    void switch_active_window();
    std::string get_input();
};
```

> ğŸ’¡ **UIæ¡†æ¶**: åŸºäºncurseswå®ç°ç»ˆç«¯UIï¼Œæ”¯æŒUTF-8ä¸­æ–‡æ˜¾ç¤ºå’Œé¢œè‰²ä¸»é¢˜ã€‚

### ChatManager ç±»
```cpp
class ChatManager {
private:
    int server_sock;
    Chat current_chat;
    std::vector<ChatInfo> chat_list;
    std::string current_chat_id;
    WindowManager *window_manager;
    std::string current_user_id;
    std::string current_username;

public:
    ChatManager(int server_sock, WindowManager *window_manager,
                std::string user_id, std::string username);
    
    // æ ¸å¿ƒæ–¹æ³•
    void initiate();                                    // åˆå§‹åŒ–èŠå¤©ç®¡ç†å™¨
    
    // æœåŠ¡å™¨å“åº”å¤„ç†
    void handle_chat_lists(const ServerPacket &packet);     // å¤„ç†èŠå¤©åˆ—è¡¨
    void handle_chat_history(const ServerPacket &packet);   // å¤„ç†æ¶ˆæ¯å†å²
    void handle_new_message(const ServerPacket &packet);    // å¤„ç†æ–°æ¶ˆæ¯
    void handle_new_chat(const ServerPacket &packet);       // å¤„ç†æ–°èŠå¤©å®¤
    
    // èŠå¤©æ“ä½œ
    void create_chat(const std::string &chatname);          // åˆ›å»ºèŠå¤©å®¤
    void join_chat(const std::string &chat_id);             // åŠ å…¥èŠå¤©å®¤
    void leave_chat(const std::string &chat_id);            // ç¦»å¼€èŠå¤©å®¤
    void add_message(const std::string &message);           // å‘é€æ¶ˆæ¯
    void recall_message(const std::string &message_id);      // æ’¤å›æ¶ˆæ¯
    
    // æ•°æ®è·å–
    std::vector<Message> get_current_chat_messages();       // è·å–å½“å‰èŠå¤©æ¶ˆæ¯
    std::vector<ChatInfo> get_chat_list();                  // è·å–èŠå¤©åˆ—è¡¨
};
```

> ğŸ’¡ **çŠ¶æ€ç®¡ç†**: ç»´æŠ¤å½“å‰èŠå¤©çŠ¶æ€ï¼Œè‡ªåŠ¨åŒæ­¥æœåŠ¡å™¨æ•°æ®åˆ°æœ¬åœ°UIã€‚

## ç”¨æˆ·ç•Œé¢è®¾è®¡

### çª—å£å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DuckChat - ç”¨æˆ·å                    [çŠ¶æ€] [æ—¶é—´]          â”‚ æ ‡é¢˜æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èŠå¤©åˆ—è¡¨     â”‚ èŠå¤©æ¶ˆæ¯åŒºåŸŸ                                  â”‚
â”‚ âœ“ èŠå¤©å®¤1    â”‚ [ç”¨æˆ·1] 12:30: Hello World!                  â”‚
â”‚ âœ“ èŠå¤©å®¤2    â”‚ [ç”¨æˆ·2] 12:31: Hi there!                     â”‚
â”‚   èŠå¤©å®¤3    â”‚ [ç”¨æˆ·1] 12:32: How are you?                  â”‚
â”‚   èŠå¤©å®¤4    â”‚                                               â”‚
â”‚   èŠå¤©å®¤5    â”‚                                               â”‚
â”‚             â”‚                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ > è¾“å…¥æ¶ˆæ¯å†…å®¹...                                          â”‚ è¾“å…¥æ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çª—å£åŠŸèƒ½
1. **æ ‡é¢˜æ **: æ˜¾ç¤ºåº”ç”¨åç§°ã€å½“å‰ç”¨æˆ·ã€è¿æ¥çŠ¶æ€å’Œæ—¶é—´
2. **èŠå¤©åˆ—è¡¨**: æ˜¾ç¤ºç”¨æˆ·å‚ä¸çš„æ‰€æœ‰èŠå¤©å®¤ï¼Œæ”¯æŒé€‰æ‹©åˆ‡æ¢
3. **æ¶ˆæ¯åŒºåŸŸ**: æ˜¾ç¤ºå½“å‰èŠå¤©å®¤çš„æ¶ˆæ¯å†å²ï¼Œæ”¯æŒæ»šåŠ¨æŸ¥çœ‹
4. **è¾“å…¥æ **: ç”¨æˆ·è¾“å…¥æ¶ˆæ¯çš„åœ°æ–¹ï¼Œæ”¯æŒå¤šè¡Œè¾“å…¥

## åè®®å¤„ç†é€»è¾‘

### å®¢æˆ·ç«¯è¯·æ±‚å¤„ç†

#### èŠå¤©ç®¡ç†å™¨åˆå§‹åŒ–

```cpp
// å®Œæ•´å®ç°è§: chat_manager.cpp:31-44
void ChatManager::initiate() {
    // è¯·æ±‚ç”¨æˆ·çš„èŠå¤©åˆ—è¡¨
    ClientPacket chats_request;
    chats_request.request = ClientMessage::LIST_CHATS;
    chats_request.user_id = current_user_id;
    send_packet(server_sock, chats_request);

    // å¤„ç†æœåŠ¡å™¨å“åº”å¹¶æ›´æ–°UI
    ServerPacket chats_packet = recv_server_packet(server_sock);
    handle_chat_lists(chats_packet);
}
```

#### æ ¸å¿ƒæ“ä½œæµç¨‹

| æ“ä½œ | å®ç°ä½ç½® | å…³é”®æ­¥éª¤ |
|------|----------|----------|
| **å‘é€æ¶ˆæ¯** | [`chat_manager.cpp:58`](../client/chat_manager.cpp:58) | ç”Ÿæˆæœ¬åœ°æ¶ˆæ¯ID â†’ å‘é€æœåŠ¡å™¨ â†’ ç«‹å³æ˜¾ç¤ºæœ¬åœ° |
| **åˆ›å»ºèŠå¤©å®¤** | [`chat_manager.cpp:129`](../client/chat_manager.cpp:129) | å‘é€åˆ›å»ºè¯·æ±‚ â†’ ç­‰å¾…æœåŠ¡å™¨å“åº” â†’ æ›´æ–°èŠå¤©åˆ—è¡¨ |
| **åŠ å…¥èŠå¤©å®¤** | [`chat_manager.cpp:164`](../client/chat_manager.cpp:164) | å‘é€åŠ å…¥è¯·æ±‚ â†’ è·å–èŠå¤©å†å² â†’ åˆ‡æ¢å½“å‰èŠå¤© |
| **æ’¤å›æ¶ˆæ¯** | [`chat_manager.cpp:152`](../client/chat_manager.cpp:152) | å‘é€æ’¤å›è¯·æ±‚ â†’ æœåŠ¡å™¨å¹¿æ’­ â†’ æ›´æ–°æœ¬åœ°æ˜¾ç¤º |

#### æ¶ˆæ¯å‘é€ç¤ºä¾‹

```cpp
// ç®€åŒ–ç‰ˆæ¶ˆæ¯å‘é€ - å®Œæ•´å®ç°è§: chat_manager.cpp:58-76
void ChatManager::add_message(const std::string &message) {
    ClientPacket packet;
    packet.request = ClientMessage::MESSAGE;
    packet.user_id = current_user_id;
    packet.chat_id = current_chat_id;
    packet.message = message;
    packet.message_id = Utils::get_uuid();  // ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID

    send_packet(server_sock, packet);
    
    // ç«‹å³æ˜¾ç¤ºæœ¬åœ°æ¶ˆæ¯ï¼Œæä¾›å³æ—¶åé¦ˆ
    Message new_message(packet, Utils::get_iso_timestamp());
    current_chat.add_message(new_message);
    window_manager->render_chat_history(current_chat.get_messages());
}
```

> ğŸ’¡ **ç”¨æˆ·ä½“éªŒ**: é‡‡ç”¨"ä¹è§‚UI"ç­–ç•¥ï¼Œå‘é€æ¶ˆæ¯åç«‹å³æ˜¾ç¤ºï¼Œæ— éœ€ç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ã€‚

### æœåŠ¡å™¨å“åº”å¤„ç†

#### ç½‘ç»œæ¥æ”¶å¾ªç¯

å®¢æˆ·ç«¯ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹å¤„ç†æœåŠ¡å™¨å“åº”ï¼Œç¡®ä¿UIå“åº”æ€§ï¼š

```mermaid
sequenceDiagram
    participant UI as UIä¸»çº¿ç¨‹
    participant Net as ç½‘ç»œçº¿ç¨‹
    participant Chat as ChatManager
    participant Win as WindowManager
    
    UI->>Net: å¯åŠ¨ç½‘ç»œçº¿ç¨‹
    loop æŒç»­ç›‘å¬
        Net->>Net: recv_server_packet()
        Net->>Chat: handle_*_packet()
        Chat->>Win: render_*()
        Win-->>UI: æ›´æ–°æ˜¾ç¤º
    end
```

#### å“åº”åˆ†å‘é€»è¾‘ - [`client.cpp:163-192`](../client/client.cpp:163)

```cpp
void handle_server_receive() {
    while (true) {
        ServerPacket packet = recv_server_packet(server_fd);

        switch (packet.request) {
        case ServerMessage::NEW_MESSAGE:
            chat_manager.handle_new_message(packet);
            break;
        case ServerMessage::RETURN_CHATS:
            chat_manager.handle_chat_lists(packet);
            break;
        case ServerMessage::RETURN_MESSAGES:
            chat_manager.handle_chat_history(packet);
            break;
        case ServerMessage::JOIN_CHAT_RESPONSE:
        case ServerMessage::CREATE_CHAT_RESPONSE:
            chat_manager.handle_new_chat(packet);
            break;
        }
    }
}
```

> âš ï¸ **çº¿ç¨‹å®‰å…¨**: UIæ›´æ–°æ“ä½œåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œç½‘ç»œçº¿ç¨‹ä»…è´Ÿè´£æ•°æ®æ¥æ”¶å’Œè§£æã€‚

#### æœåŠ¡å™¨å“åº”å¤„ç†å®ç°

| å“åº”ç±»å‹ | å¤„ç†æ–¹æ³• | å®ç°ä½ç½® | ä¸»è¦é€»è¾‘ |
|----------|----------|----------|----------|
| **èŠå¤©åˆ—è¡¨** | `handle_chat_lists()` | [`chat_manager.cpp:46`](../client/chat_manager.cpp:46) | æ›´æ–°æœ¬åœ°èŠå¤©åˆ—è¡¨å¹¶æ¸²æŸ“UI |
| **æ¶ˆæ¯å†å²** | `handle_chat_history()` | [`chat_manager.cpp:52`](../client/chat_manager.cpp:52) | åŠ è½½èŠå¤©å†å²å¹¶æ˜¾ç¤º |
| **æ–°æ¶ˆæ¯** | `handle_new_message()` | [`chat_manager.cpp:78`](../client/chat_manager.cpp:78) | æ·»åŠ åˆ°å½“å‰èŠå¤©å¹¶æ›´æ–°UI |
| **æ–°èŠå¤©å®¤** | `handle_new_chat()` | [`chat_manager.cpp:106`](../client/chat_manager.cpp:106) | åŠ å…¥èŠå¤©åˆ—è¡¨å¹¶è·å–å†å² |

**æ–°æ¶ˆæ¯å¤„ç†ç¤ºä¾‹** - [`chat_manager.cpp:78`](../client/chat_manager.cpp:78):
```cpp
void ChatManager::handle_new_message(const ServerPacket &packet) {
    if (packet.status == ServerStatus::SUCCESS && !packet.messages.empty()) {
        Message message = packet.messages[0];
        
        // åªå¤„ç†å½“å‰èŠå¤©å®¤çš„æ¶ˆæ¯
        if (packet.chats.empty() || packet.chats[0].chat_id != current_chat_id) {
            return;
        }
        
        current_chat.add_message(message);
        window_manager->render_chat_history(current_chat.get_messages());
    }
}
```

**æ–°èŠå¤©å®¤å¤„ç†ç¤ºä¾‹** - [`chat_manager.cpp:106`](../client/chat_manager.cpp:106):
```cpp
void ChatManager::handle_new_chat(const ServerPacket &packet) {
    if (packet.chats.empty()) return;
    
    chat_list.push_back(packet.chats[0]);
    current_chat_id = packet.chats[0].chat_id;
    window_manager->render_chats(chat_list);
    
    // è‡ªåŠ¨è·å–èŠå¤©å†å²
    ClientPacket request_packet;
    request_packet.request = ClientMessage::FETCH_MESSAGES;
    request_packet.chat_id = current_chat_id;
    send_packet(server_sock, request_packet);
}
```

> ğŸ’¡ **è‡ªåŠ¨åŒæ­¥**: åŠ å…¥èŠå¤©å®¤åè‡ªåŠ¨è·å–æ¶ˆæ¯å†å²ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚

## çª—å£ç®¡ç†å®ç°

### UIæ¶æ„è®¾è®¡

å®¢æˆ·ç«¯é‡‡ç”¨ç±»vimçš„åˆ†å‰²çª—å£å¸ƒå±€ï¼ŒåŸºäºncurseswå®ç°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DuckChat - ç”¨æˆ·å                    [çŠ¶æ€] [æ—¶é—´]          â”‚ çŠ¶æ€æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èŠå¤©åˆ—è¡¨     â”‚ èŠå¤©æ¶ˆæ¯åŒºåŸŸ                                  â”‚
â”‚ âœ“ èŠå¤©å®¤1    â”‚ [ç”¨æˆ·1] 12:30: Hello World!                  â”‚
â”‚ âœ“ èŠå¤©å®¤2    â”‚ [ç”¨æˆ·2] 12:31: Hi there!                     â”‚
â”‚   èŠå¤©å®¤3    â”‚ [ç”¨æˆ·1] 12:32: How are you?                  â”‚
â”‚             â”‚                                               â”‚ ä¸»å†…å®¹åŒº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ > è¾“å…¥æ¶ˆæ¯å†…å®¹...                                          â”‚ è¾“å…¥æ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆå§‹åŒ–å’Œå¸ƒå±€ - [`window_manager.cpp:13-87`](../client/window_manager.cpp:13)

```cpp
void WindowManager::initiate() {
    // 1. åˆå§‹åŒ–ncurseswç¯å¢ƒ
    setlocale(LC_ALL, "zh_CN.UTF-8");  // æ”¯æŒä¸­æ–‡
    initscr();
    cbreak();
    noecho();
    keypad(stdscr, TRUE);
    start_color();
    
    // 2. å®šä¹‰é¢œè‰²ä¸»é¢˜
    init_pair(1, COLOR_RED, COLOR_BLACK);    // é”™è¯¯ä¿¡æ¯
    init_pair(2, COLOR_GREEN, COLOR_BLACK);  // æˆåŠŸä¿¡æ¯
    init_pair(3, COLOR_CYAN, COLOR_BLACK);   // çŠ¶æ€ä¿¡æ¯
    init_pair(4, COLOR_WHITE, COLOR_BLUE);   // æ´»åŠ¨çª—å£é«˜äº®
    
    // 3. åˆ›å»ºåˆ†å‰²çª—å£
    int scr_line, scr_col;
    getmaxyx(stdscr, scr_line, scr_col);
    
    chat_list_window = newwin(scr_line - 2, scr_col / 4, 0, 0);
    message_window = newwin(scr_line - 2, scr_col - scr_col / 4, 0, scr_col / 4);
    status_window = newwin(1, scr_col, scr_line - 2, 0);
    input_window = newwin(1, scr_col, scr_line - 1, 0);
}
```

### è¾“å…¥å¤„ç†æœºåˆ¶ - [`window_manager.cpp:89-206`](../client/window_manager.cpp:89)

å®¢æˆ·ç«¯é‡‡ç”¨å‘½ä»¤æ¨¡å¼çš„äº¤äº’è®¾è®¡ï¼š

| æŒ‰é”® | åŠŸèƒ½ | å®ç°ä½ç½® |
|------|------|----------|
| `m` | è¿›å…¥æ¶ˆæ¯å‘é€æ¨¡å¼ | [`window_manager.cpp:101`](../client/window_manager.cpp:101) |
| `:` | è¿›å…¥å‘½ä»¤æ¨¡å¼ | [`window_manager.cpp:113`](../client/window_manager.cpp:113) |
| `TAB` | åˆ‡æ¢æ´»åŠ¨çª—å£ | [`window_manager.cpp:160`](../client/window_manager.cpp:160) |
| `â†‘/â†“` | æ»šåŠ¨æ¶ˆæ¯/èŠå¤©åˆ—è¡¨ | [`window_manager.cpp:163`](../client/window_manager.cpp:163) |
| `â†/â†’` | åˆ‡æ¢çª—å£æ¨¡å¼ | [`window_manager.cpp:177`](../client/window_manager.cpp:177) |
| `q` | é€€å‡ºç¨‹åº | [`window_manager.cpp:96`](../client/window_manager.cpp:96) |

**å‘½ä»¤æ¨¡å¼æ”¯æŒ**:
- `:cc <åç§°>` - åˆ›å»ºèŠå¤©å®¤
- `:jc <ID>` - åŠ å…¥èŠå¤©å®¤
- `:lc <ID>` - ç¦»å¼€èŠå¤©å®¤
- `:help` - æ˜¾ç¤ºå¸®åŠ©

### æ¸²æŸ“ç³»ç»Ÿ

| æ¸²æŸ“æ–¹æ³• | åŠŸèƒ½ | å®ç°ä½ç½® |
|----------|------|----------|
| `render_chat_history()` | æ¸²æŸ“æ¶ˆæ¯å†å² | [`window_manager.cpp:279`](../client/window_manager.cpp:279) |
| `render_chats()` | æ¸²æŸ“èŠå¤©åˆ—è¡¨ | [`window_manager.cpp:380`](../client/window_manager.cpp:380) |
| `show_status()` | æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯ | [`window_manager.cpp:479`](../client/window_manager.cpp:479) |

> ğŸ’¡ **ç”¨æˆ·ä½“éªŒ**: æ”¯æŒUTF-8ä¸­æ–‡æ˜¾ç¤ºï¼Œé¢œè‰²ä¸»é¢˜åŒºåˆ†ä¸åŒç±»å‹ä¿¡æ¯ï¼Œæ»šåŠ¨æŸ¥çœ‹å†å²è®°å½•ã€‚

## å®‰å…¨ç‰¹æ€§

### å½“å‰å®‰å…¨å®ç°

| å®‰å…¨ç‰¹æ€§ | å®ç°çŠ¶æ€ | è¯´æ˜ |
|----------|----------|------|
| **å¯†ç å“ˆå¸Œ** | âœ… å·²å®ç° | ä½¿ç”¨SHA256å“ˆå¸Œå­˜å‚¨å¯†ç  - [`client.cpp:143`](../client/client.cpp:143) |
| **æ¶ˆæ¯åŠ å¯†** | â³ è®¡åˆ’ä¸­ | é¢„ç•™åŠ å¯†æ¥å£ï¼Œå¾…å®ç°AES-256-CBC |
| **è¾“å…¥éªŒè¯** | âœ… éƒ¨åˆ†å®ç° | åŸºæœ¬çš„æ¶ˆæ¯é•¿åº¦å’Œæ ¼å¼æ£€æŸ¥ |
| **è¿æ¥éªŒè¯** | âœ… å·²å®ç° | ä½¿ç”¨`check_online()`æ£€æµ‹è¿æ¥çŠ¶æ€ |

### å¯†ç å“ˆå¸Œå®ç°

```cpp
// SHA256å¯†ç å“ˆå¸Œ - å®Œæ•´å®ç°è§: client.cpp:143-161
string sha256(const std::string &str) {
    EVP_MD_CTX *mdctx = EVP_MD_CTX_new();
    const EVP_MD *md = EVP_sha256();
    unsigned char hash[EVP_MAX_MD_SIZE];
    unsigned int hash_len;

    EVP_DigestInit_ex(mdctx, md, NULL);
    EVP_DigestUpdate(mdctx, str.c_str(), str.length());
    EVP_DigestFinal_ex(mdctx, hash, &hash_len);
    EVP_MD_CTX_free(mdctx);

    std::stringstream ss;
    for (unsigned int i = 0; i < hash_len; i++) {
        ss << hex << setw(2) << setfill('0') << (int)hash[i];
    }
    return ss.str();
}
```

### è®¡åˆ’ä¸­çš„åŠ å¯†åŠŸèƒ½

```cpp
// é¢„ç•™çš„æ¶ˆæ¯åŠ å¯†æ¥å£ (å¾…å®ç°)
class MessageEncryption {
private:
    std::string encryption_key;
    
public:
    std::string encrypt(const std::string& plaintext);
    std::string decrypt(const std::string& ciphertext);
    
private:
    std::string aes_encrypt(const std::string& data, const std::string& key);
    std::string aes_decrypt(const std::string& data, const std::string& key);
};
```

> âš ï¸ **å®‰å…¨å»ºè®®**: å½“å‰SHA256å®ç°æœªåŠ ç›ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨bcryptæˆ–PBKDF2å¢å¼ºå®‰å…¨æ€§ã€‚

## å½“å‰å®ç°çŠ¶æ€

### âœ… å·²å®ç°åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | å®ç°çŠ¶æ€ | å…³é”®æ–‡ä»¶ |
|----------|----------|----------|
| **UIæ¡†æ¶** | âœ… å®Œæˆ | [`window_manager.cpp`](../client/window_manager.cpp) |
| **ç½‘ç»œé€šä¿¡** | âœ… å®Œæˆ | [`network.cpp`](../common/network.cpp) |
| **ç”¨æˆ·è®¤è¯** | âœ… å®Œæˆ | [`client.cpp:54-116`](../client/client.cpp:54) |
| **èŠå¤©ç®¡ç†** | âœ… å®Œæˆ | [`chat_manager.cpp`](../client/chat_manager.cpp) |
| **æ¶ˆæ¯ç³»ç»Ÿ** | âœ… å®Œæˆ | [`chat_manager.cpp:58-76`](../client/chat_manager.cpp:58) |
| **UIäº¤äº’** | âœ… å®Œæˆ | [`window_manager.cpp:89-206`](../client/window_manager.cpp:89) |
| **å¤šçº¿ç¨‹** | âœ… å®Œæˆ | [`client.cpp:133-134`](../client/client.cpp:133) |

### â³ å¾…å®ç°åŠŸèƒ½

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | å®ç°å»ºè®® |
|------|--------|----------|
| **æ¶ˆæ¯åŠ å¯†** | é«˜ | é›†æˆOpenSSLå®ç°ç«¯åˆ°ç«¯åŠ å¯† |
| **æ–‡ä»¶ä¼ è¾“** | ä¸­ | æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ç­‰æ–‡ä»¶ç±»å‹ |
| **è¡¨æƒ…æ”¯æŒ** | ä¸­ | é›†æˆemojiè¡¨æƒ…å’Œè‡ªå®šä¹‰è¡¨æƒ… |
| **é€šçŸ¥ç³»ç»Ÿ** | ä¸­ | æ¡Œé¢é€šçŸ¥å’Œå£°éŸ³æé†’ |
| **ä¸»é¢˜ç³»ç»Ÿ** | ä½ | å¤šç§é¢œè‰²ä¸»é¢˜å’Œè‡ªå®šä¹‰ä¸»é¢˜ |
| **é…ç½®ç®¡ç†** | ä½ | ç”¨æˆ·é…ç½®æ–‡ä»¶å’Œè®¾ç½®ç•Œé¢ |

### ğŸ”§ å…³é”®è®¾è®¡å†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹©çš„æ–¹æ¡ˆ | åŸå›  | æ›¿ä»£æ–¹æ¡ˆ |
|--------|------------|------|----------|
| **UIæ¡†æ¶** | ncursesw | è·¨å¹³å°ç»ˆç«¯UIï¼Œæ”¯æŒä¸­æ–‡ | Qt/GTKå›¾å½¢ç•Œé¢ |
| **çº¿ç¨‹æ¨¡å‹** | UI+ç½‘ç»œåŒçº¿ç¨‹ | ç®€å•å¯é ï¼Œé¿å…é˜»å¡ | å•çº¿ç¨‹å¼‚æ­¥I/O |
| **æ¶ˆæ¯åŒæ­¥** | ä¹è§‚UI | å³æ—¶åé¦ˆï¼Œç”¨æˆ·ä½“éªŒå¥½ | ä¸¥æ ¼æœåŠ¡å™¨ç¡®è®¤ |
| **è¾“å…¥æ¨¡å¼** | å‘½ä»¤æ¨¡å¼ | é«˜æ•ˆï¼Œç±»ä¼¼vimæ“ä½œ | å›¾å½¢åŒ–æŒ‰é’®æ“ä½œ |

### ğŸ“Š ç”¨æˆ·ä½“éªŒç‰¹å¾

| ç‰¹æ€§ | å½“å‰è¡¨ç° | æ”¹è¿›å»ºè®® |
|------|----------|----------|
| **å“åº”é€Ÿåº¦** | <50msæœ¬åœ°å“åº” | ä¼˜åŒ–æ¸²æŸ“ç®—æ³• |
| **å†…å­˜ä½¿ç”¨** | åŸºç¡€æ¶ˆæ¯ç¼“å­˜ | å®ç°æ¶ˆæ¯åˆ†é¡µ |
| **ç½‘ç»œå»¶è¿Ÿ** | <100mså±€åŸŸç½‘ | æ·»åŠ æ¶ˆæ¯é‡è¯•æœºåˆ¶ |
| **æ˜“ç”¨æ€§** | å‘½ä»¤è¡Œæ“ä½œ | æ·»åŠ å¿«æ·é”®æç¤º |

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ğŸ¨ UIæ¸²æŸ“ä¼˜åŒ–

| ä¼˜åŒ–æ–¹å‘ | å½“å‰å®ç° | æ”¹è¿›æ–¹æ¡ˆ |
|----------|----------|----------|
| **æ¸²æŸ“ç­–ç•¥** | å…¨é‡é‡ç»˜ | å¢é‡æ›´æ–°ï¼Œåªåˆ·æ–°å˜åŒ–åŒºåŸŸ |
| **æ¶ˆæ¯æ˜¾ç¤º** | å…¨éƒ¨åŠ è½½ | è™šæ‹Ÿæ»šåŠ¨ï¼ŒæŒ‰éœ€æ¸²æŸ“å¯è§æ¶ˆæ¯ |
| **å†…å­˜ç®¡ç†** | åŸºç¡€ç¼“å­˜ | LRUç¼“å­˜ï¼Œé™åˆ¶å†…å­˜ä½¿ç”¨ |
| **å“åº”æ€§èƒ½** | å³æ—¶æ¸²æŸ“ | å¼‚æ­¥æ¸²æŸ“ï¼Œé¿å…UIé˜»å¡ |

### ğŸŒ ç½‘ç»œä¼˜åŒ–

| ä¼˜åŒ–æ–¹å‘ | å½“å‰å®ç° | æ”¹è¿›æ–¹æ¡ˆ |
|----------|----------|----------|
| **è¿æ¥ç®¡ç†** | åŸºç¡€é‡è¿ | æŒ‡æ•°é€€é¿é‡è¿ï¼Œè¿æ¥æ±  |
| **æ¶ˆæ¯ä¼ è¾“** | å³æ—¶å‘é€ | æ‰¹é‡å‘é€ï¼Œå‹ç¼©ä¼ è¾“ |
| **çŠ¶æ€åŒæ­¥** | è½®è¯¢æ›´æ–° | æ¨é€é€šçŸ¥ï¼Œå¢é‡åŒæ­¥ |
| **é”™è¯¯å¤„ç†** | åŸºç¡€å¤„ç† | å®Œå–„é‡è¯•æœºåˆ¶å’Œé™çº§ç­–ç•¥ |

### ğŸ’¾ å†…å­˜ä¼˜åŒ–

| ä¼˜åŒ–æ–¹å‘ | å½“å‰å®ç° | æ”¹è¿›æ–¹æ¡ˆ |
|----------|----------|----------|
| **å¯¹è±¡ç®¡ç†** | ç›´æ¥åˆ›å»º | å¯¹è±¡æ± å¤ç”¨ï¼Œå‡å°‘åˆ†é… |
| **æ¶ˆæ¯å†å²** | å…¨éƒ¨ä¿å­˜ | åˆ†é¡µåŠ è½½ï¼Œå®šæœŸæ¸…ç† |
| **æ™ºèƒ½æŒ‡é’ˆ** | æ‰‹åŠ¨ç®¡ç† | RAIIï¼Œè‡ªåŠ¨èµ„æºç®¡ç† |
| **å†…å­˜ç›‘æ§** | æ— ç›‘æ§ | æ·»åŠ å†…å­˜ä½¿ç”¨ç»Ÿè®¡ |

## æ‰©å±•åŠŸèƒ½å»ºè®®

### ğŸ¯ çŸ­æœŸæ‰©å±• (1-2ä¸ªæœˆ)

1. **æ¶ˆæ¯åŠ å¯†** - ç«¯åˆ°ç«¯åŠ å¯†ä¿æŠ¤éšç§
2. **æ–‡ä»¶ä¼ è¾“** - æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£åˆ†äº«
3. **è¡¨æƒ…ç³»ç»Ÿ** - emojiå’Œè‡ªå®šä¹‰è¡¨æƒ…
4. **é€šçŸ¥æé†’** - æ¡Œé¢é€šçŸ¥å’Œå£°éŸ³æé†’

### ğŸš€ ä¸­æœŸæ‰©å±• (3-6ä¸ªæœˆ)

1. **ä¸»é¢˜ç³»ç»Ÿ** - å¤šç§é¢œè‰²ä¸»é¢˜å’Œè‡ªå®šä¹‰
2. **æœç´¢åŠŸèƒ½** - å…¨æ–‡æœç´¢æ¶ˆæ¯å’ŒèŠå¤©è®°å½•
3. **å¿«æ·å›å¤** - é¢„è®¾å›å¤æ¨¡æ¿
4. **é…ç½®ç®¡ç†** - ç”¨æˆ·è®¾ç½®å’Œåå¥½ç®¡ç†

### ğŸŒŸ é•¿æœŸè§„åˆ’ (6ä¸ªæœˆ+)

1. **æ’ä»¶ç³»ç»Ÿ** - æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶æ‰©å±•
2. **å¤šè¯­è¨€æ”¯æŒ** - å›½é™…åŒ–å’Œæœ¬åœ°åŒ–
3. **è¯­éŸ³æ¶ˆæ¯** - è¯­éŸ³å½•åˆ¶å’Œæ’­æ”¾
4. **æ¶ˆæ¯çŠ¶æ€** - å·²è¯»/æœªè¯»çŠ¶æ€æ˜¾ç¤º